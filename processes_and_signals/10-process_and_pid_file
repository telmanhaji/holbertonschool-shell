#!/usr/bin/env bash
# This script runs a daemon, creates a PID file, and traps signals.

#  Define the path for our PID file
PID_FILE="/var/run/myscript.pid"

#  Define a cleanup function to be called on exit
cleanup() {
  #  Remove the PID file when the script stops
  rm -f "$PID_FILE"
  #  Exit the script successfully
  exit 0
}

#  Set the traps
#  1. SIGINT (Ctrl+C): Just display a message and continue
trap 'echo " Y U no love me?!"' SIGINT

#  2. SIGTERM (pkill): Display a message, then call cleanup
trap 'echo " I hate the kill command"; cleanup' SIGTERM

#  3. SIGQUIT: Just call cleanup
trap 'cleanup' SIGQUIT

#  --- Main Script Starts Here ---

#  1. Create the PID file and write our own PID ($$) into it.
#     This needs 'sudo' to work.
echo "$$" > "$PID_FILE"

#  2. Start the infinite loop
while true
do
  echo "To infinity and beyond"
  sleep 2
done
